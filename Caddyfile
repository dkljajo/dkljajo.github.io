{
	email dkljajo@gmail.com
}

dkljajo.duckdns.org {
	encode gzip zstd

	# Reverse proxy services
	reverse_proxy /nextcloud/* nextcloud:80
	reverse_proxy /admin/* pihole:80
	reverse_proxy /cmk/* checkmk:5000

	# Redirect root to Nextcloud
	handle_path / {
		redir /nextcloud/
	}

	# Security headers
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "no-referrer-when-downgrade"
		Permissions-Policy "geolocation=(), microphone=(), camera=()"
	}

	# Enable HTTPS via DuckDNS DNS challenge
	tls {
		dns duckdns {env.DUCKDNS_TOKEN}
	}

	log {
		output stdout
		format console
	}
}
